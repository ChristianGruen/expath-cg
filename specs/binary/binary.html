<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Binary Module</title><link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css" /><style type="text/css">
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

ol.enumar      { list-style-type: decimal; }
ol.enumla      { list-style-type: lower-alpha; }
ol.enumlr      { list-style-type: lower-roman; }
ol.enumua      { list-style-type: upper-alpha; }
ol.enumur      { list-style-type: upper-roman; }


div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

      code.function { font-weight: bold; }
      code.type { font-style: italic; }
      /* h1, h2, h3 { color: #84001C; background: white } */
      /* a, :link, :visited, a:active { color: #84005C; background: white } */
      body {
        background-image: url(http://expath.org/images/logo-candidate.png);
      }
   </style></head><body><p><a href="http://w3.org/"><img src="http://w3.org/Icons/w3c_home" alt="W3C" height="48" width="72" /></a></p><div class="head">
<h1><a name="title" id="title"></a>Binary Module</h1>
<h2><a name="w3c-doctype" id="w3c-doctype"></a>EXPath Candidate Module 14 February 2013</h2><dl><dt>This version:</dt><dd>
         <a href="http://expath.org/spec/binary/editor">http://expath.org/spec/binary/editor</a>
      </dd><dt>Latest version:</dt><dd>
         <a href="http://expath.org/spec/binary">http://expath.org/spec/binary</a>
      </dd><dt>Previous version:</dt><dd>
         <a href="http://expath.org/spec/binary/20130214">http://expath.org/spec/binary/20130214</a><br />
      </dd><dt>Editor:</dt><dd>Jirka Kosek</dd></dl><p>This document is also available in these non-normative formats: <a href="http://expath.org/spec/binary/editor.xml">XML</a>.</p><p class="copyright">Copyright ©2013 Jirka Kosek, published by the <a href="http://w3.org/community/expath/">EXPath Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
            License Agreement (CLA)</a>. A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is
            available.</p><p class="copyright">This specification was published by the <a href="http://www.w3.org/community/expath/">EXPath Community Group</a>. It is not a W3C Standard nor is it on the W3C Standards
            Track. Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
            License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
            Learn more about <a href="http://www.w3.org/community/">W3C Community and Business
            Groups</a>.</p></div><hr /><div>
<h2><a name="abstract" id="abstract"></a>Abstract</h2><p>This proposal provides an API for XPath 2.0 to handle binary data. It defines extension
            functions to read binary files, perform basic binary operations on the data in memory,
            as well as a new serialization method. It has been designed to be compatible with XQuery
            1.0 and XSLT 2.0, as well as any other XPath 2.0 usage.</p></div><div class="toc">
<h2><a name="contents" id="contents"></a>Table of Contents</h2><p class="toc">1 <a href="#d3e73">Introduction</a><br />
    1.1 <a href="#d3e76">Namespace Conventions</a><br />
2 <a href="#d3e95">Loading binary data</a><br />
3 <a href="#d3e110">Basic operations</a><br />
4 <a href="#d3e145">Text decoding/encoding</a><br />
5 <a href="#d3e162">Packing/unpacking of encoded number values</a><br />
6 <a href="#d3e197">Bitwise operations</a><br />
7 <a href="#d3e236">Another functions</a><br />
8 <a href="#d3e241">Serialization</a><br />
</p>
<h3><a name="appendices" id="appendices"></a>Appendices</h3><p class="toc">A <a href="#d3e251">References</a><br />
B <a href="#d3e270">Summary of Error Conditions</a><br />
</p></div><hr /><div class="body"><div class="div1">
<h2><a name="d3e73" id="d3e73"></a>1 Introduction</h2><div class="div2">
<h3><a name="d3e76" id="d3e76"></a>1.1 Namespace Conventions</h3><p>The module defined by this document defines several functions and a serialization
               method, all contained in the namespace <code>http://expath.org/ns/binary</code>. In
               this document, the <code>bin</code> prefix, when used, is bound to this namespace
               URI.</p><p>Error codes are defined in the namespace <code>http://expath.org/ns/error</code>. In
               this document, the <code>err</code> prefix, when used, is bound to this namespace
               URI.</p></div></div><div class="div1">
<h2><a name="d3e95" id="d3e95"></a>2 Loading binary data</h2><div class="exampleInner"><pre>
<code class="function">bin:unparsed-binary</code>($href as <code class="type">xs:string</code>?) as <code class="type">xs:hexBinary</code></pre></div><p>Reads binary content and returns it as xs:hexBinary.</p></div><div class="div1">
<h2><a name="d3e110" id="d3e110"></a>3 Basic operations</h2><div class="exampleInner"><pre>
<code class="function">binary-subsequence</code>($in as <code class="type">xs:hexBinary</code>,
                   $offset as <code class="type">xs:integer</code>,
                   $size as <code class="type">xs:integer</code>) as <code class="type">xs:hexBinary</code></pre></div><p>Returns just part of original binary data starting at $offset (zero based). Size of
            returned data is $size octets.</p><div class="exampleInner"><pre>
<code class="function">binary-length</code>($in as xs:hexBinary) as xs:integer</pre></div><p>Returns size of binary data in octets.</p><div class="exampleInner"><pre>
<code class="function">binary-concat</code>($in1 as xs:hexBinary, $in2 as xs:hexBinary, ...) as xs:hexBinary</pre></div><p>Concatenates all provided binary data blocks into one large one.</p></div><div class="div1">
<h2><a name="d3e145" id="d3e145"></a>4 Text decoding/encoding</h2><div class="exampleInner"><pre>
<code class="function">decode-string</code>($in as xs:hexBinary, $encoding as $xs:string) as xs:string</pre></div><p>Decodes octets according to a given encoding.</p><div class="exampleInner"><pre>
<code class="function">encode-string</code>($in as xs:string, $encoding as $xs:string) as xs:hexBinary</pre></div><p>Encodes string using given encoding into octets.</p></div><div class="div1">
<h2><a name="d3e162" id="d3e162"></a>5 Packing/unpacking of encoded number values</h2><div class="exampleInner"><pre>
<code class="function">unpack-double</code>($in as xs:hexBinary, $offset as xs:integer) as xs:double</pre></div><p>Returns xs:double value which is stored at $offset. Little endian representation is
            assumed.</p><div class="exampleInner"><pre>
<code class="function">unpack-double</code>($in as xs:hexBinary,
              $offset as xs:integer,
              $bigendian as xs:boolean) as xs:double</pre></div><p>Returns xs:double value which is stored at $offset. If $bigendian is true, big endian
            representation is assumed, otherwise little endian is assumed.</p><p>Analogic functions for other numeric types will be provided: unpack-float(),
            unpack-long(), unpack-int(), unpack-short(), unpack-byte(), unpack-unsignedLong(),
            unpack-unsignedInt(), unpack-unsignedShort(), unpack-unsignedByte().</p><div class="exampleInner"><pre>
<code class="function">pack-double</code>($in as xs:double) as xs:hexBinary</pre></div><p>Returns binary representation of xs:double using little endian representation.</p><div class="exampleInner"><pre>
<code class="function">pack-double</code>($in as xs:double, $bigendian as xs:boolean) as xs:hexBinary</pre></div><p>Returns binary representation of xs:double value. If $bigendian is true, big endian
            representation is used, otherwise little endian is used.</p><p>Analogic functions for other numeric types will be provided: pack-float(), pack-long(),
            pack-int(), pack-short(), pack-byte(), pack-unsignedLong(), pack-unsignedInt(),
            pack-unsignedShort(), pack-unsignedByte().</p></div><div class="div1">
<h2><a name="d3e197" id="d3e197"></a>6 Bitwise operations</h2><p>For now functions will be provided only. Later on we can override some operators as
            well.</p><div class="exampleInner"><pre>
<code class="function">binary-or</code>($a as xs:hexBinary, $b as xs:hexBinary) as xs:hexBinary</pre></div><p>Returns "bitwise or" applied on $a and $b. If $a and $b do not have same binary-length()
            then shorter is padded with zero octets to match size of longer argument.</p><div class="exampleInner"><pre>
<code class="function">binary-xor</code>(...)
<code class="function">binary-and</code>(...)
<code class="function">binary-not</code>(...)</pre></div><div class="exampleInner"><pre>
<code class="function">binary-shift-left</code>($in as xs:hexBinary, $by as xs:integer) as xs:hexBinary</pre></div><p>Shift bits in $in value left by $by bits.</p><div class="exampleInner"><pre>
<code class="function">binary-shift-right</code>($in as xs:hexBinary, $by as xs:integer) as xs:hexBinary</pre></div><p>Shift bits in $in value right by $by bits.</p><p>We can also provide rotation. For shifts we have to decide whether they should be
            logical (strictly operating on bits) or arithmetical (taking sign bit into account) or
            provide parameter for this.</p></div><div class="div1">
<h2><a name="d3e236" id="d3e236"></a>7 Another functions</h2><p>We might provide functions for converting strings written in hex, octal and binary
            notation to number types.</p></div><div class="div1">
<h2><a name="d3e241" id="d3e241"></a>8 Serialization</h2><p>I think that we shouldn't use function for serialization because of side-effects. I
            think that more cleaner would be to provide new output method for
            xsl:result-document:</p><div class="exampleInner"><pre>
&lt;xsl:result-document href="..." method="binary"&gt;
  union(xs:hexBinary, xs:base64Binary)*
&lt;/xsl:result-document&gt;</pre></div><p>For binary output method we can require that sequence constructor inside
            xsl:result-document returns only sequence mixing xs:base64Binary and xs:hexBinary
            types.</p></div></div><div class="back"><div class="div1">
<h2><a name="d3e251" id="d3e251"></a>A References</h2><dl><dt class="label"><a name="xserial" id="xserial"></a>Serialization</dt><dd>
               <a href="http://www.w3.org/TR/xslt-xquery-serialization/">XSLT 2.0 and XQuery 1.0
               Serialization</a>. Scott Boag, Michael Kay, Joanne Tong, Norman Walsh, and Henry
               Zongaro, editors. W3C Recommendation. 23 January 2007. </dd><dt class="label"><a name="fo11" id="fo11"></a>F&amp;O 1.1</dt><dd>
               <a href="http://www.w3.org/TR/xpath-functions-11/">XPath and XQuery Functions and
                  Operators 1.1</a>. Michael Kay, editor. W3C Working Draft. 15 January 2009.</dd><dt class="label"><a name="xslt20" id="xslt20"></a>XSLT 2.0</dt><dd>
               <a href="http://www.w3.org/TR/xslt20/">XSL Transformations (XSLT) Version 2.0</a>.
               Michael Kay, editor. W3C Recommendation. 23 January 2007. </dd></dl></div><div class="div1">
<h2><a name="d3e270" id="d3e270"></a>B Summary of Error Conditions</h2><dl><dt class="label"><a name="errBIN001" id="errBIN001"></a>err:BIN001</dt><dd>Some error occurred.</dd></dl></div></div><script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
         </script><script type="text/javascript">
            try {
               var pageTracker = _gat._getTracker("UA-5463082-2");
               pageTracker._trackPageview();
            } catch(err) {}
         </script></body></html>