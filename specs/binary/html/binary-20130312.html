<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Binary Module</title><link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css" /><style type="text/css">
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

ol.enumar      { list-style-type: decimal; }
ol.enumla      { list-style-type: lower-alpha; }
ol.enumlr      { list-style-type: lower-roman; }
ol.enumua      { list-style-type: upper-alpha; }
ol.enumur      { list-style-type: upper-roman; }


div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

      code.function { font-weight: bold; }
      code.type { font-style: italic; }
      /* h1, h2, h3 { color: #84001C; background: white } */
      /* a, :link, :visited, a:active { color: #84005C; background: white } */
      body {
        background-image: url(http://expath.org/images/logo-candidate.png);
      }
   </style></head><body><p><a href="http://w3.org/"><img src="http://w3.org/Icons/w3c_home" alt="W3C" height="48" width="72" /></a></p><div class="head">
<h1><a name="title" id="title"></a>Binary Module</h1>
<h2><a name="w3c-doctype" id="w3c-doctype"></a>EXPath Candidate Module 12 March 2013</h2><dl><dt>This version:</dt><dd>
         <a href="http://expath.org/spec/binary/20130312">http://expath.org/spec/binary/20130312</a>
      </dd><dt>Latest version:</dt><dd>
         <a href="http://expath.org/spec/binary">http://expath.org/spec/binary</a>
      </dd><dt>Editor:</dt><dd>Jirka Kosek &lt;<a href="mailto:jirka@kosek.cz">jirka@kosek.cz</a>&gt;</dd></dl><p>This document is also available in these non-normative formats: <a href="http://expath.org/spec/binary/20130312.xml">XML</a>.</p><p class="copyright">Copyright ©2013 Jirka Kosek, published by the <a href="http://w3.org/community/expath/">EXPath Community Group</a> under the <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
            License Agreement (CLA)</a>. A human-readable <a href="http://www.w3.org/community/about/agreements/cla-deed/">summary</a> is
            available.</p><p class="copyright">This specification was published by the <a href="http://www.w3.org/community/expath/">EXPath Community Group</a>. It is not a W3C Standard nor is it on the W3C Standards
            Track. Please note that under the <a href="http://www.w3.org/community/about/agreements/cla/">W3C Community Contributor
            License Agreement (CLA)</a> there is a limited opt-out and other conditions apply.
            Learn more about <a href="http://www.w3.org/community/">W3C Community and Business
            Groups</a>.</p></div><hr /><div>
<h2><a name="abstract" id="abstract"></a>Abstract</h2><p>This proposal provides an API for XPath 2.0 to handle binary data. It defines extension
            functions to read binary files, perform basic binary operations on the data in memory,
            as well as a new serialization method. It has been designed to be compatible with XQuery
            1.0 and XSLT 2.0, as well as any other XPath 2.0 usage.</p></div><div class="toc">
<h2><a name="contents" id="contents"></a>Table of Contents</h2><p class="toc">1 <a href="#status">Status of this document</a><br />
2 <a href="#introduction">Introduction</a><br />
    2.1 <a href="#d6e82">Namespace Conventions</a><br />
3 <a href="#use-cases">Use cases</a><br />
4 <a href="#loading">Loading binary data</a><br />
    4.1 <a href="#fun-bin-unparsed-binary">bin:unparsed-binary</a><br />
5 <a href="#d6e194">Basic operations</a><br />
    5.1 <a href="#fun-bin-binary-subsequence">bin:binary-subsequence</a><br />
    5.2 <a href="#fun-bin-binary-length">bin:binary-length</a><br />
    5.3 <a href="#fun-bin-binary-join">bin:binary-join</a><br />
    5.4 <a href="#fun-bin-binary-to-octets">bin:binary-to-octets</a><br />
    5.5 <a href="#fun-bin-octets-to-binary">bin:octets-to-binary</a><br />
6 <a href="#text-decoding-encoding">Text decoding and encoding</a><br />
    6.1 <a href="#fun-bin-decode-string">bin:decode-string</a><br />
    6.2 <a href="#fun-bin-unpack-string">bin:unpack-string</a><br />
    6.3 <a href="#fun-bin-encode-string">bin:encode-string</a><br />
7 <a href="#packing-unpacking">Packing and unpacking of encoded numeric values</a><br />
    7.1 <a href="#fun-bin-unpack-double">bin:unpack-double</a><br />
    7.2 <a href="#fun-bin-unpack-float">bin:unpack-float</a><br />
    7.3 <a href="#fun-bin-unpack-long">bin:unpack-long</a><br />
    7.4 <a href="#fun-bin-unpack-unsignedLong">bin:unpack-unsignedLong</a><br />
    7.5 <a href="#fun-bin-unpack-int">bin:unpack-int</a><br />
    7.6 <a href="#fun-bin-unpack-unsignedInt">bin:unpack-unsignedInt</a><br />
    7.7 <a href="#fun-bin-unpack-short">bin:unpack-short</a><br />
    7.8 <a href="#fun-bin-unpack-unsignedShort">bin:unpack-unsignedShort</a><br />
    7.9 <a href="#fun-bin-unpack-byte">bin:unpack-byte</a><br />
    7.10 <a href="#fun-bin-unpack-unsignedByte">bin:unpack-unsignedByte</a><br />
    7.11 <a href="#fun-bin-pack-double">bin:pack-double</a><br />
    7.12 <a href="#fun-bin-pack-float">bin:pack-float</a><br />
    7.13 <a href="#fun-bin-pack-long">bin:pack-long</a><br />
    7.14 <a href="#fun-bin-pack-unsignedLong">bin:pack-unsignedLong</a><br />
    7.15 <a href="#fun-bin-pack-int">bin:pack-int</a><br />
    7.16 <a href="#fun-bin-pack-unsignedInt">bin:pack-unsignedInt</a><br />
    7.17 <a href="#fun-bin-pack-short">bin:pack-short</a><br />
    7.18 <a href="#fun-bin-pack-unsignedShort">bin:pack-unsignedShort</a><br />
    7.19 <a href="#fun-bin-pack-byte">bin:pack-byte</a><br />
    7.20 <a href="#fun-bin-pack-unsignedByte">bin:pack-unsignedByte</a><br />
8 <a href="#bitwise">Bitwise operations</a><br />
    8.1 <a href="#fun-bin-binary-or">bin:binary-or</a><br />
    8.2 <a href="#fun-bin-binary-xor">bin:binary-xor</a><br />
    8.3 <a href="#fun-bin-binary-and">bin:binary-and</a><br />
    8.4 <a href="#fun-bin-binary-not">bin:binary-not</a><br />
    8.5 <a href="#fun-bin-binary-shift">bin:binary-shift</a><br />
9 <a href="#serialization">Serialization</a><br />
</p>
<h3><a name="appendices" id="appendices"></a>Appendices</h3><p class="toc">A <a href="#references">References</a><br />
B <a href="#errors">Summary of Error Conditions</a><br />
</p></div><hr /><div class="body"><div class="div1">
<h2><a name="status" id="status"></a>1 Status of this document</h2><p>This document is in an early draft stage. Comments are welcomed at <a href="mailto:public-expath@w3.org">public-expath@w3.org</a> mailing list (<a href="http://lists.w3.org/Archives/Public/public-expath/">archive</a>).</p></div><div class="div1">
<h2><a name="introduction" id="introduction"></a>2 Introduction</h2><div class="div2">
<h3><a name="d6e82" id="d6e82"></a>2.1 Namespace Conventions</h3><p>The module defined by this document defines several functions and a serialization
               method, all contained in the namespace <code>http://expath.org/ns/binary</code>. In
               this document, the <code>bin</code> prefix, when used, is bound to this namespace
               URI.</p><p>Error codes are defined in the namespace <code>http://expath.org/ns/error</code>. In
               this document, the <code>err</code> prefix, when used, is bound to this namespace
               URI.</p></div></div><div class="div1">
<h2><a name="use-cases" id="use-cases"></a>3 Use cases</h2><p>Development of this specification was driven strictly by requirements which XML
            developer regularly faces.</p><p>Some typical use cases:</p><ul><li><p>Getting dimensions of an image file.</p></li><li><p>Extracting image metadata.</p></li><li><p>Processing images embeded and base64 encoded inside SOAP message.</p></li><li><p>Processing legacy text file which uses several different encodings in different
                  places.</p></li></ul></div><div class="div1">
<h2><a name="loading" id="loading"></a>4 Loading binary data</h2><div class="div2">
<h3><a name="fun-bin-unparsed-binary" id="fun-bin-unparsed-binary"></a>4.1 bin:unparsed-binary</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>The <code>bin:unparsed-binary</code> function reads an external resource (for example,
            an image file) and returns a binary data of the resource.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unparsed-binary</code>($href as <code class="type">xs:string?</code>) as <code class="type">xs:hexBinary?</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The <code>$href</code> argument <strong>must</strong> be a string in the form of a URI
            reference, which <strong>must</strong> contain no fragment identifier, and
            <strong>must</strong> identify a resource for which a string representation is
            available. If the URI is a relative URI reference, then it is resolved relative to the
            Static Base URI property from the static context.</p>
         <p>If the value of the <code>$href</code> argument is an empty sequence, the function
            returns an empty sequence.</p>
         <p>The result of the function is a binary value of the resource retrieved using the
            URI.</p>
      </dd><dt class="label">Examples</dt><dd>
            <p>Converting external images in HTML document into internal data: resources:</p>
            <div class="exampleInner"><pre>
&lt;xsl:template match="img[ends-with(@src, '.jpg')]"&gt;
   &lt;xsl:copy&gt;
      &lt;xsl:copy-of select="@* except @src"/&gt;
      &lt;xsl:attribute name="src"&gt;
         &lt;xsl:text&gt;data:image/jpeg;base64,&lt;/xsl:text&gt;
         &lt;xsl:value-of select="xs:base64Binary(bin:unparsed-binary(resolve-uri(@src)))"/&gt;
      &lt;/xsl:attribute&gt;
   &lt;/xsl:copy&gt;
&lt;/xsl:template&gt;</pre></div>
         </dd></dl></div><div class="div1">
<h2><a name="d6e194" id="d6e194"></a>5 Basic operations</h2><div class="div2">
<h3><a name="fun-bin-binary-subsequence" id="fun-bin-binary-subsequence"></a>5.1 bin:binary-subsequence</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>The <code>bin:binary-subsequence</code> functions returns specified part of binary
            data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-subsequence</code>($in     as <code class="type">xs:hexBinary</code>,
                       $offset as <code class="type">xs:integer</code>,
                       $size   as <code class="type">xs:integer</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns part of original binary data starting at <code>$offset</code>. Size of returned
            data is <code>$size</code> octets.</p>
         <p>The <code>$offset</code> is zero based.</p>
         <p>The value of <code>$offset</code> argument <strong>must</strong> be non-negative
            integer.</p>
         <p>It is dynamic error if <code>$offset</code> + <code>$size</code> is larger then size of
            binary data passed in <code>$in</code> argument.</p>
      </dd><dt class="label">Examples</dt><dd>
            <p>Testing whether <code>$data</code> variable contains content of PDF file:</p>
            <div class="exampleInner"><pre>bin:binary-subsequence($data, 0, 4) eq xs:hexBinary("25504446")</pre></div>
            <p><code>25504446</code> is magic number for PDF files, it is US-ASCII encoded value for
               <code>%PDF</code>.</p>
         </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-length" id="fun-bin-binary-length"></a>5.2 bin:binary-length</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>The <code>bin:binary-length</code> functions returns size of binary data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-length</code>($in as <code class="type">xs:hexBinary</code>) as <code class="type">xs:integer</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns size of binary data in octets.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-join" id="fun-bin-binary-join"></a>5.3 bin:binary-join</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns a binary data created by concatenating the binary data items in a sequence.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-join</code>($in as <code class="type">xs:hexBinary*</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The function returns an <code>xs:hexBinary</code> created by concatenating the items in
            the sequence <code>$in</code>, in order.</p>
      </dd><dt class="label">Notes</dt><dd>
         <p>If the value of <code>$in</code> is the empty sequence, the function returns the
            zero-length binary data.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-to-octets" id="fun-bin-binary-to-octets"></a>5.4 bin:binary-to-octets</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary data as a sequence of octets.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-to-octets</code>($in as <code class="type">xs:hexBinary</code>) as <code class="type">xs:integer*</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>If <code>$in</code> is zero length binary data then empty sequence is returned.</p>
         <p>Octets are returned as integers from 0 to 255.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-octets-to-binary" id="fun-bin-octets-to-binary"></a>5.5 bin:octets-to-binary</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Converts sequence of octets into binary data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:octets-to-binary</code>($in as <code class="type">xs:integer*</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Octets are integers from 0 to 255.</p>
      </dd></dl></div><div class="div1">
<h2><a name="text-decoding-encoding" id="text-decoding-encoding"></a>6 Text decoding and encoding</h2><div class="div2">
<h3><a name="fun-bin-decode-string" id="fun-bin-decode-string"></a>6.1 bin:decode-string</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Decodes binary data as a string in a given encoding.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:decode-string</code>($in       as <code class="type">xs:hexBinary</code>,
                  $encoding as <code class="type">xs:string</code>) as <code class="type">xs:string</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The <code>$encoding</code> argument is the name of an encoding. The values for this
            attribute follow the same rules as for the <code>encoding</code> attribute in an XML
            declaration. The only values which every implementation is <strong>required</strong>
            to recognize are <code>utf-8</code> and <code>utf-16</code>.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-string" id="fun-bin-unpack-string"></a>6.2 bin:unpack-string</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Decodes chunk of binary data at a specified offset as a string in a given encoding.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-string</code>($in       as <code class="type">xs:hexBinary</code>,
                  $offset   as <code class="type">xs:integer</code>,
                  $size     as <code class="type">xs:integer</code>,
                  $encoding as <code class="type">xs:string</code>) as <code class="type">xs:string</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>If <code>$size</code> is greater then 0 this function is identical to calling
            <code>bin:decode-string(bin:binary-subsequence($in, $offset, $size),
            $encoding)</code>.</p>
         <p>If <code>$size</code> is zero then all non-zero octets starting at <code>$offset</code>
            until first zero octet are extracted and then decoding is applied. This way
            zero-terminated strings can be easily decoded.</p>
         <p>The <code>$encoding</code> argument is the name of an encoding. The values for this
            attribute follow the same rules as for the <code>encoding</code> attribute in an XML
            declaration. The only values which every implementation is <strong>required</strong>
            to recognize are <code>utf-8</code> and <code>utf-16</code>.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-encode-string" id="fun-bin-encode-string"></a>6.3 bin:encode-string</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Encodes string into binary data using a given encoding.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:encode-string</code>($in       as <code class="type">xs:string</code>,
                  $encoding as <code class="type">xs:string</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The <code>$encoding</code> argument is the name of an encoding. The values for this
            attribute follow the same rules as for the <code>encoding</code> attribute in an XML
            declaration. The only values which every implementation is <strong>required</strong>
            to recognize are <code>utf-8</code> and <code>utf-16</code>.</p>
      </dd></dl></div><div class="div1">
<h2><a name="packing-unpacking" id="packing-unpacking"></a>7 Packing and unpacking of encoded numeric values</h2><div class="div2">
<h3><a name="fun-bin-unpack-double" id="fun-bin-unpack-double"></a>7.1 bin:unpack-double</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract double value stored at the particular offset in binary data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-double</code>($in     as <code class="type">xs:hexBinary</code>,
                  $offset as <code class="type">xs:integer</code>) as <code class="type">xs:double</code>

<code class="function">bin:unpack-double</code>($in        as <code class="type">xs:hexBinary</code>,
                  $offset    as <code class="type">xs:integer</code>,
                  $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:double</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-float" id="fun-bin-unpack-float"></a>7.2 bin:unpack-float</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract float value stored at the particular offset in binary data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-float</code>($in     as <code class="type">xs:hexBinary</code>,
                 $offset as <code class="type">xs:integer</code>) as <code class="type">xs:float</code>

<code class="function">bin:unpack-float</code>($in        as <code class="type">xs:hexBinary</code>,
                 $offset    as <code class="type">xs:integer</code>,
                 $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:float</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-long" id="fun-bin-unpack-long"></a>7.3 bin:unpack-long</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract long (64-bit signed integer) value stored at the particular offset in binary
            data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-long</code>($in     as <code class="type">xs:hexBinary</code>,
                $offset as <code class="type">xs:integer</code>) as <code class="type">xs:long</code>

<code class="function">bin:unpack-long</code>($in        as <code class="type">xs:hexBinary</code>,
                $offset    as <code class="type">xs:integer</code>,
                $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:long</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-unsignedLong" id="fun-bin-unpack-unsignedLong"></a>7.4 bin:unpack-unsignedLong</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract unsignedLong (64-bit unsigned integer) value stored at the particular offset in
            binary data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-unsignedLong</code>($in     as <code class="type">xs:hexBinary</code>,
                        $offset as <code class="type">xs:integer</code>) as <code class="type">xs:unsignedLong</code>

<code class="function">bin:unpack-unsignedLong</code>($in        as <code class="type">xs:hexBinary</code>,
                        $offset    as <code class="type">xs:integer</code>,
                        $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:unsignedLong</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-int" id="fun-bin-unpack-int"></a>7.5 bin:unpack-int</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract int (32-bit signed integer) value stored at the particular offset in binary
            data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-int</code>($in     as <code class="type">xs:hexBinary</code>,
               $offset as <code class="type">xs:integer</code>) as <code class="type">xs:int</code>

<code class="function">bin:unpack-int</code>($in        as <code class="type">xs:hexBinary</code>,
               $offset    as <code class="type">xs:integer</code>,
               $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:int</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-unsignedInt" id="fun-bin-unpack-unsignedInt"></a>7.6 bin:unpack-unsignedInt</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract unsignedInt (32-bit unsigned integer) value stored at the particular offset in
            binary data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-unsignedInt</code>($in     as <code class="type">xs:hexBinary</code>,
                       $offset as <code class="type">xs:integer</code>) as <code class="type">xs:unsignedInt</code>

<code class="function">bin:unpack-unsignedInt</code>($in        as <code class="type">xs:hexBinary</code>,
                       $offset    as <code class="type">xs:integer</code>,
                       $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:unsignedInt</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-short" id="fun-bin-unpack-short"></a>7.7 bin:unpack-short</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract short (16-bit signed integer) value stored at the particular offset in binary
            data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-short</code>($in     as <code class="type">xs:hexBinary</code>,
                 $offset as <code class="type">xs:integer</code>) as <code class="type">xs:short</code>

<code class="function">bin:unpack-short</code>($in        as <code class="type">xs:hexBinary</code>,
                 $offset    as <code class="type">xs:integer</code>,
                 $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:short</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-unsignedShort" id="fun-bin-unpack-unsignedShort"></a>7.8 bin:unpack-unsignedShort</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract unsignedShort (16-bit unsigned integer) value stored at the particular offset in
            binary data.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-unsignedShort</code>($in     as <code class="type">xs:hexBinary</code>,
                         $offset as <code class="type">xs:integer</code>) as <code class="type">xs:unsignedShort</code>

<code class="function">bin:unpack-unsignedShort</code>($in        as <code class="type">xs:hexBinary</code>,
                         $offset    as <code class="type">xs:integer</code>,
                         $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:unsignedShort</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-byte" id="fun-bin-unpack-byte"></a>7.9 bin:unpack-byte</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract byte (8-bit signed integer) value stored at the particular offset in binary
            data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-byte</code>($in     as <code class="type">xs:hexBinary</code>,
                $offset as <code class="type">xs:integer</code>) as <code class="type">xs:byte</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-unpack-unsignedByte" id="fun-bin-unpack-unsignedByte"></a>7.10 bin:unpack-unsignedByte</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Extract unsignedByte (8-bit unsigned integer) value stored at the particular offset in
            binary data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:unpack-unsignedByte</code>($in     as <code class="type">xs:hexBinary</code>,
                        $offset as <code class="type">xs:integer</code>) as <code class="type">xs:unsignedByte</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>The <code>$offset</code> is zero based.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-double" id="fun-bin-pack-double"></a>7.11 bin:pack-double</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of a double value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-double</code>($in as <code class="type">xs:double</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-double</code>($in        as <code class="type">xs:double</code>,
                $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-float" id="fun-bin-pack-float"></a>7.12 bin:pack-float</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of a float value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-float</code>($in as <code class="type">xs:float</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-float</code>($in        as <code class="type">xs:float</code>,
               $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-long" id="fun-bin-pack-long"></a>7.13 bin:pack-long</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of a long value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-long</code>($in as <code class="type">xs:long</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-long</code>($in        as <code class="type">xs:long</code>,
              $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-unsignedLong" id="fun-bin-pack-unsignedLong"></a>7.14 bin:pack-unsignedLong</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of an unsignedLong (64-bit unsigned integer) value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-unsignedLong</code>($in as <code class="type">xs:unsignedLong</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-unsignedLong</code>($in        as <code class="type">xs:unsignedLong</code>,
                      $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-int" id="fun-bin-pack-int"></a>7.15 bin:pack-int</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of an int (32-bit signed integer) value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-int</code>($in as <code class="type">xs:int</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-int</code>($in        as <code class="type">xs:int</code>,
             $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-unsignedInt" id="fun-bin-pack-unsignedInt"></a>7.16 bin:pack-unsignedInt</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of an unsignedInt (32-bit unsigned integer) value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-unsignedInt</code>($in as <code class="type">xs:unsignedInt</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-unsignedInt</code>($in        as <code class="type">xs:unsignedInt</code>,
                     $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-short" id="fun-bin-pack-short"></a>7.17 bin:pack-short</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of a short (16-bit signed integer) value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-short</code>($in as <code class="type">xs:short</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-short</code>($in        as <code class="type">xs:short</code>,
               $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-unsignedShort" id="fun-bin-pack-unsignedShort"></a>7.18 bin:pack-unsignedShort</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of an unsignedShort (16-bit unsigned integer) value.</p>
      </dd><dt class="label">Signatures</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-unsignedShort</code>($in as <code class="type">xs:unsignedShort</code>) as <code class="type">xs:hexBinary</code>

<code class="function">bin:pack-unsignedShort</code>($in        as <code class="type">xs:unsignedShort</code>,
                       $bigendian as <code class="type">xs:boolean</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Little endian number representation is assumed unless <code>$bigendian</code> parameter
            is specified and has <code>true()</code> value.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-byte" id="fun-bin-pack-byte"></a>7.19 bin:pack-byte</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of a byte (8-bit signed integer) value.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-byte</code>($in as <code class="type">xs:byte</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p></p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-pack-unsignedByte" id="fun-bin-pack-unsignedByte"></a>7.20 bin:pack-unsignedByte</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns binary representation of an unsignedByte (8-bit unsigned integer) value.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:pack-unsignedByte</code>($in as <code class="type">xs:unsignedByte</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p></p>
      </dd></dl></div><div class="div1">
<h2><a name="bitwise" id="bitwise"></a>8 Bitwise operations</h2><div class="div2">
<h3><a name="fun-bin-binary-or" id="fun-bin-binary-or"></a>8.1 bin:binary-or</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns "bitwise or" applied on arguments.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-or</code>($a as <code class="type">xs:hexBinary</code>,
              $b as <code class="type">xs:hexBinary</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns "bitwise or" applied on <code>$a</code> and <code>$b</code>.</p>
         <p>If <code>$a</code> and <code>$b</code> do not have same length then shorter is padded
            with zero octets to match size of a longer argument.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-xor" id="fun-bin-binary-xor"></a>8.2 bin:binary-xor</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns "bitwise xor" applied on arguments.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-xor</code>($a as <code class="type">xs:hexBinary</code>,
               $b as <code class="type">xs:hexBinary</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns "bitwise exclusive or" applied on <code>$a</code> and <code>$b</code>.</p>
         <p>If <code>$a</code> and <code>$b</code> do not have same length then shorter is padded
            with zero octets to match size of a longer argument.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-and" id="fun-bin-binary-and"></a>8.3 bin:binary-and</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns "bitwise and" applied on arguments.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-and</code>($a as <code class="type">xs:hexBinary</code>,
               $b as <code class="type">xs:hexBinary</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns "bitwise and" applied on <code>$a</code> and <code>$b</code>.</p>
         <p>If <code>$a</code> and <code>$b</code> do not have same length then shorter is padded
            with zero octets to match size of a longer argument.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-not" id="fun-bin-binary-not"></a>8.4 bin:binary-not</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Returns "bitwise not" of an argument.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-and</code>($in as <code class="type">xs:hexBinary</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>Returns "bitwise not" applied on <code>$in</code> argument.</p>
      </dd></dl><div class="div2">
<h3><a name="fun-bin-binary-shift" id="fun-bin-binary-shift"></a>8.5 bin:binary-shift</h3></div><dl><dt class="label">Summary</dt><dd>
         <p>Shift bits in binary data.</p>
      </dd><dt class="label">Signature</dt><dd><p><div class="exampleInner"><pre>
<code class="function">bin:binary-shift</code>($in as <code class="type">xs:hexBinary</code>,
                 $by as <code class="type">xs:integer</code>) as <code class="type">xs:hexBinary</code></pre></div></p></dd><dt class="label">Rules</dt><dd>
         <p>If <code>$by</code> is positive then bits are shifted <code>$by</code> times to the
            left.</p>
         <p>If <code>$by</code> is negative then bits are shifted <code>-$by</code> times to the
            right.</p>
         <p>If <code>$by</code> is zero result is identical to <code>$in</code> argument.</p>
         <p>Result has always the same size as <code>$in</code> argument.</p>
         <p>Shift is logical, zeros are placed into discarded bits.</p>
      </dd></dl></div><div class="div1">
<h2><a name="serialization" id="serialization"></a>9 Serialization</h2><p>New serialization method <code>bin:binary</code> is defined. It can serialize sequence
            containing only items of type <code>xs:hexBinary</code> or <code>xs:base64Binary</code>.
            Such sequence is turned into one block of binary data using <code>bin:binary-join</code>
            and written out to the specified location.</p><dl><dt class="label">Examples</dt><dd><p>Joining several blobs of data into a single file:</p><div class="exampleInner"><pre>
&lt;xsl:result-document href="image.png" method="bin:binary"&gt;
   &lt;xsl:sequence select="$image-header"/&gt;
   &lt;xsl:sequence select="$image-data"/&gt;
&lt;/xsl:result-document&gt;</pre></div><p>Template for extracting HTML images represented as data: URI scheme into
                     separate external image files:</p><div class="exampleInner"><pre>
&lt;xsl:template match="img[starts-with(@src, 'data:image/png;base64,')]"&gt;
   &lt;xsl:copy&gt;
      &lt;xsl:copy-of select="@* except @src"/&gt;
      &lt;xsl:attribute name="src" select="concat(generate-id(), '.png')"/&gt;
      &lt;xsl:result-document href="{generate-id()}.png" method="bin:binary"&gt;
         &lt;xsl:sequence select="xs:base64Binary(substring-after(@src, 'data:image/png;base64,'))"/&gt;
      &lt;/xsl:result-document&gt;
   &lt;/xsl:copy&gt;
&lt;/xsl:template&gt;</pre></div></dd></dl></div></div><div class="back"><div class="div1">
<h2><a name="references" id="references"></a>A References</h2><dl><dt class="label"><a name="xserial" id="xserial"></a>Serialization</dt><dd>
               <a href="http://www.w3.org/TR/xslt-xquery-serialization/">XSLT 2.0 and XQuery 1.0
               Serialization</a>. Scott Boag, Michael Kay, Joanne Tong, Norman Walsh, and Henry
               Zongaro, editors. W3C Recommendation. 23 January 2007. </dd><dt class="label"><a name="fo11" id="fo11"></a>F&amp;O 1.1</dt><dd>
               <a href="http://www.w3.org/TR/xpath-functions-11/">XPath and XQuery Functions and
                  Operators 1.1</a>. Michael Kay, editor. W3C Working Draft. 15 January 2009.</dd><dt class="label"><a name="xslt20" id="xslt20"></a>XSLT 2.0</dt><dd>
               <a href="http://www.w3.org/TR/xslt20/">XSL Transformations (XSLT) Version 2.0</a>.
               Michael Kay, editor. W3C Recommendation. 23 January 2007.</dd></dl></div><div class="div1">
<h2><a name="errors" id="errors"></a>B Summary of Error Conditions</h2><div class="note"><p class="prefix"><b>Note:</b></p><p>Proper error codes and conditions will be defined in the next version of this
               draft.</p></div></div></div><script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
         </script><script type="text/javascript">
            try {
               var pageTracker = _gat._getTracker("UA-5463082-2");
               pageTracker._trackPageview();
            } catch(err) {}
         </script></body></html>
